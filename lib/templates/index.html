<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>{{ title }}</title>

        <script src="bundle.js"></script>
    </head>

    <body>
        <div class="tracker-container">
            <div class="tracker">
                <h1>{{ title }}</h1>

                <div class="intro">
                    {{ intro_text|safe }}
                </div>

                <dl class="status-chart-legend">
                  {% for status in statuses %}
                  <div class="status-chart-legend__item">
                    <dt class="status-chart-legend__color status-chart-legend__color--{{ status.slug }}"></dt>
                    <dd class="status-chart-legend__label">{{ status.status }}</dd>
                  </div>
                  {% endfor %}
                </dl>


                <div class="status-chart">
                    {% for status in statuses %}
                    <div class="status-chart__bar status-chart__bar--{{ status.slug }}"
                         style="width: {{ status.pctRecommendations * 100 }}%"
                         data-status="{{ status.status }}"
                         data-count="{{ status.recommendations.length }}"
                         data-slug="{{ status.slug }}">
                    </div>
                    {% endfor %}
                </div>

                <div class="filters">
                    <div class="filter-set">
                        <h2 class="filter-set__label">Status</h2>

                        {% for status in statuses %}
                        <a href="#" class="status-filter status-filter--{{ status.slug }}" data-status="{{ status.status }}">{{ status.status }}</a>
                        {% endfor %}
                    </div>
                </div>

                {% for category in categories %}
                <div class="category" data-slug="{{ category.slug }}">
                    <h2 class="category__name"><a href="#">{{ category.name }}</a></h2>

                    {% for recommendation in category.recommendations %}
                    <div data-id="{{ recommendation.id }}"
                      data-status="{{ recommendation.status }}"
                      class="recommendation recommendation--{{ recommendation.statusSlug }}">
                      <h3 class="recommendation__gist"><a href="#">{{ recommendation.recommendation_gist }}</a></h3>

                        <div><span class="recommendation__status recommendation__status--{{ recommendation.statusSlug }}">{{ recommendation.status }}</span></div>

                        <div class="recommendation__specific">
                            {{ recommendation.recommendation_specific }}
                        </div>

                        <ul class="agencies">
                            {% for agency in recommendation.agency_responsible %}
                            <li class="agency">{{ agency }}</li>
                            {% endfor %}
                        </ul>

                        <ul class="recommendation__updates">
                            {% for update in recommendation.updates %}
                            <li class="update">
                              <h4 class="update__date">{{ update.date }}</h3>
                              <div class="update__notes">
                                  {{ update.notes | safe }}
                              </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
        <script>
            document.querySelectorAll('.tracker-container').forEach(function(el) {
              new dojtracker.App(el);
            });
        </script>
    </body>
</html>
